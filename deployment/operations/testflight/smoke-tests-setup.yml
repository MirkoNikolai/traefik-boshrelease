---

- path: /instance_groups/name=traefik/jobs/name=traefik/properties/traefik?/accept_invalid_backend_certificates
  type: replace
  value: true

- path: /instance_groups/name=traefik/jobs/name=traefik/properties/traefik/file?
  type: replace
  value:
    enabled: true
    rules: |
      [backends]
        [backends.traefik-ui]
          [backends.traefik-ui.servers.server1]
          url = "https://127.0.0.1:8443"

        [backends.mockbin-http-backend]
          [backends.mockbin-http-backend.servers.http]
          url = "http://mockbin.org:80"

        [backends.mockbin-tls-backend]
          [backends.mockbin-tls-backend.servers.tls]
          url = "https://mockbin.org:443"

      [frontends]
        [frontends.traefik-ui]
          entrypoints = [ "https" ]
          priority = 20
          backend = "traefik-ui"
          passHostHeader = true

          [frontends.traefik-ui.routes]
            [frontends.traefik-ui.routes.route1]
              rule = "Host: ((api_hostname))"

        [frontends.mockbin-http-frontend]
          entrypoints = [ "http" ]
          priority = 10
          backend = "mockbin-http-backend"
          passHostHeader = true

          [frontends.mockbin-http-frontend.routes]
            [frontends.mockbin-http-frontend.routes.http]
              rule = "Host: ((frontend_hostname))"

        [frontends.mockbin-tls-frontend]
          entrypoints = [ "https" ]
          priority = 10
          backend = "mockbin-tls-backend"
          passHostHeader = true

          [frontends.mockbin-tls-frontend.routes]
            [frontends.mockbin-tls-frontend.routes.tls]
              rule = "Host: ((frontend_hostname))"
    watch: true

- path: /instance_groups/name=traefik/jobs/name=smoke-tests?
  type: replace
  value:
    name: smoke-tests
    release: traefik
    properties:
      frontend_hostname: ((frontend_hostname))
      api_hostname: ((api_hostname))
