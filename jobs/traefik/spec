---
name: traefik

description: This job runs a Traefik reverse-proxy.

templates:
  bin/traefik_ctl: bin/traefik_ctl
  bin/bpm-prestart: bin/bpm-prestart
  bin/dns/healthy: bin/dns/healthy
  bpm.yml: config/bpm.yml
  config/traefik.yml: config/traefik.yml
  config.d/dynamic.readme: config.d/dynamic.readme
  config.d/dynamic.yml: config.d/dynamic.yml
  config/tls/one.crt: config/tls/one.crt
  config/tls/one.key: config/tls/one.key
  config/tls/two.crt: config/tls/two.crt
  config/tls/two.key: config/tls/two.key
  config/tls/three.crt: config/tls/three.crt
  config/tls/three.key: config/tls/three.key
  config/tls/four.crt: config/tls/four.crt
  config/tls/four.key: config/tls/four.key
  config/tls/five.crt: config/tls/five.crt
  config/tls/five.key: config/tls/five.key

packages:
  - traefik

provides:
  - name: traefik
    type: traefik
    properties:
      - traefik.base_config
      - traefik.dynamic_config
      
properties:
  bpm.enabled:
    description: |
      Switch to BPM (Bosh Process Manager) for running Traefik. This brings
      the benefit of improved security measures at runtime.
    default: false

  traefik.api.enabled:
    description: |
      Whether the Traefik API should be enabled.

      This will enable:
        - A REST API endpoint.
        - A '/ping' endpoint for healthchecks.
        - A metrics endpoint for Prometheus to scrape.

      Please take care not exposing this endpoint to the entire Internet,
      otherwise your server could get compromized by malicious users.
    default: false
    
  traefik.dashboard.enabled:
    description: |
      Whether the Traefik API should be enabled.

      This will enable:
        - A web UI that can be used to dynamically read or modify the Traefik
          configuration.
    
      Please take care not exposing this endpoint to the entire Internet,
      otherwise your server could get compromized by malicious users.
    default: false


  traefik.base_config:
    description: |
      This is a bosh release as single instance. So provide unter traefik.conf 
      property the full configuration

      default: false
  
  traefik.dynamic_config:
    description: |
      This is a bosh release as single instance. This is the dynamic configuration part

      default: false
  
  traefik.tls_crt_one:
    description: |
      copy the tls_crt.one to ../conf/tls/one.crt

      default: false

  traefik.tls_crt_two:
    description: |
      copy the tls_crt_two to ../conf/tls/two.crt

      default: false

  traefik.tls_crt_three:
    description: |
      copy the tls_crt_three to ../conf/tls/three.crt

      default: false

  traefik.tls_crt_four:
    description: |
      copy the tls_crt_four to ../conf/tls/four.crt

      default: false

  traefik.tls_crt_five:
    description: |
      copy the tls_crt_five to ../conf/tls/five.crt

      default: false

  traefik.tls_key_one:
    description: |
      copy the tls.key.one to ../conf/tls/one.key

      default: false

  traefik.tls_key_two:
    description: |
      copy the tls_key_two to ../conf/tls/two.key

      default: false

  traefik.tls_key_three:
    description: |
      copy the tls_key_three to ../conf/tls/three.key

      default: false

  traefik.tls_key_four:
    description: |
      copy the tls_key_four to ../conf/tls/four.key

      default: false

  traefik.tls_key_five:
    description: |
      copy the tls_key_five to ../conf/tls/five.crt

      default: false
