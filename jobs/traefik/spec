---
name: traefik

description: This job runs a Traefik reverse-proxy.

templates:
  bin/traefik_ctl: bin/traefik_ctl
  bin/bpm-prestart: bin/bpm-prestart
  bin/dns/healthy: bin/dns/healthy
  bpm.yml: config/bpm.yml
  config/traefik.yml: config/traefik.yml
  config.d/dynamic.readme: config.d/dynamic.readme
  config.d/dynamic.yml: config.d/dynamic.yml
  config/tls/01.crt: config/tls/01.crt
  config/tls/01.key: config/tls/01.key
  config/tls/02.crt: config/tls/02.crt
  config/tls/02.key: config/tls/02.key
  config/tls/03.crt: config/tls/03.crt
  config/tls/03.key: config/tls/03.key
  config/tls/04.crt: config/tls/04.crt
  config/tls/04.key: config/tls/04.key
  config/tls/05.crt: config/tls/05.crt
  config/tls/05.key: config/tls/05.key

packages:
  - traefik

provides:
  - name: traefik
    type: traefik
    properties:
      - traefik.base_config
      - traefik.dynamic_config
      
properties:
  bpm.enabled:
    description: |
      Switch to BPM (Bosh Process Manager) for running Traefik. This brings
      the benefit of improved security measures at runtime.
    default: false

  traefik.api.enabled:
    description: |
      Whether the Traefik API should be enabled.

      This will enable:
        - A REST API endpoint.
        - A '/ping' endpoint for healthchecks.
        - A metrics endpoint for Prometheus to scrape.

      Please take care not exposing this endpoint to the entire Internet,
      otherwise your server could get compromized by malicious users.
    default: false
    
  traefik.dashboard.enabled:
    description: |
      Whether the Traefik API should be enabled.

      This will enable:
        - A web UI that can be used to dynamically read or modify the Traefik
          configuration.
    
      Please take care not exposing this endpoint to the entire Internet,
      otherwise your server could get compromized by malicious users.
    default: false


  traefik.base_config:
    description: |
      This is a bosh release as single instance. So provide unter traefik.conf 
      property the full configuration

      default: false
  
  traefik.dynamic_config:
    description: |
      This is a bosh release as single instance. This is the dynamic configuration part

      default: false
  
  traefik.tls.crt.01:
    description: |
      copy the tls.crt.01 to ../conf/tls/01.crt

      default: false

  traefik.tls.crt.02:
    description: |
      copy the tls.crt.02 to ../conf/tls/02.crt

      default: false

  traefik.tls.crt.03:
    description: |
      copy the tls.crt.03 to ../conf/tls/03.crt

      default: false

  traefik.tls.crt.04:
    description: |
      copy the tls.crt.04 to ../conf/tls/04.crt

      default: false

  traefik.tls.crt.05:
    description: |
      copy the tls.crt.05 to ../conf/tls/05.crt

      default: false

  traefik.tls.key.01:
    description: |
      copy the tls.key.01 to ../conf/tls/01.key

      default: false

  traefik.tls.key.02:
    description: |
      copy the tls.key.02 to ../conf/tls/02.key

      default: false

  traefik.tls.key.03:
    description: |
      copy the tls.key.03 to ../conf/tls/03.key

      default: false

  traefik.tls.key.04:
    description: |
      copy the tls.key.04 to ../conf/tls/04.key

      default: false

  traefik.tls.key.05:
    description: |
      copy the tls.key.05 to ../conf/tls/05.crt

      default: false
